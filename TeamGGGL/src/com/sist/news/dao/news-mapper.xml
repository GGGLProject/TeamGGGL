<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sist.news.dao.news-mapper">
	<!-- 뉴스 표시 -->
	<select id="newsListData" resultType="NewsVO" parameterType="java.util.Map">
		SELECT
		news_no,news_title,news_name,news_content,news_regdate,news_category,news_image,no
		FROM (SELECT
		news_no,news_title,news_name,news_content,news_regdate,news_category,news_image,rownum
		as no
		FROM (SELECT
		news_no,news_title,news_name,news_content,news_regdate,news_category,news_image
		FROM gggl_news
		<if test="category!='all'">
			WHERE news_category=#{category}
		</if>
		ORDER BY news_regdate ASC ))
		WHERE no BETWEEN #{start}
		AND #{end}
	</select>
	<!-- 뉴스의 페이지 갯수 계산 -->
	<select id="newsTotalPage" resultType="int">
		SELECT CEIL(COUNT(*)/10)
		FROM gggl_news
	</select>
	<!-- 뉴스의 총 갯수 계산 -->
	<select id="newsTotalCount" resultType="int">
		select count(*) from
		gggl_news
	</select>
	<!-- 상세보기 -->
	<select id="newsDetailData" resultType="NewsVO" parameterType="int">
		SELECT
		news_no,news_title,news_name,news_content,news_regdate,news_category,news_image
		FROM gggl_news
		WHERE news_no=#{news_no}
	</select>
	<select id="newsImageNo" resultType="int" parameterType="int">
		select
		news_no from gggl_news where news_no=#{news_no}
	</select>
	<select id="newsImageUrl" resultType="String" parameterType="int">
		select news_image from gggl_news where news_no=#{news_no}
	</select>
	<select id="newsRecommandData" resultType="NewsVO"
		parameterType="int">
		SELECT
		news_no,news_title from gggl_news where
		news_no=#{news_no}
	</select>
	<select id="newsUpdateListData" resultType="NewsVO">
		select * from (select
		news_no, news_title from gggl_news order by
		news_regdate desc) where
		rownum &lt;= 5
	</select>
	<select id="newsReplyCount" resultType="int" parameterType="int">
		SELECT COUNT(*) FROM news_reply
		WHERE bno=#{bno}
	</select>
	<insert id="replyNewInsert" parameterType="NewsReplyVO">
		<selectKey keyProperty="no" resultType="int" order="BEFORE">
			SELECT
			NVL(MAX(no)+1,1) as no FROM news_reply
		</selectKey>
		INSERT INTO news_reply(no,bno,id,name,msg)
		VALUES(#{no},#{bno},#{id},#{name},#{msg})
	</insert>
	<select id="replyListData" resultType="NewsReplyVO"
		parameterType="int">
		SELECT no, bno,id,name,msg,regdate from news_reply 
		WHERE bno=#{no}
		ORDER BY regdate DESC
	</select>
	<update id="replyUpdate" parameterType="NewsReplyVO">
		UPDATE news_reply SET
		msg=#{msg}
		WHERE no=#{no}
	</update>
	<delete id="replyDelete" parameterType="int">
		DELETE FROM news_reply
		WHERE
		no=#{no}
	</delete>
	<select id="newsSearchData" resultType="NewsVO" parameterType="String">
		select * from gggl_news where news_title like '%'||#{searchkey}||'%'
	</select>
	<!-- 댓글 추가(새로운) -->
	<!-- 찾기 find <select id="boardFindData" resultType="BoardVO" parameterType="java.util.Map"> 
		SELECT no,subject,name,regdate,hit FROM gggl_news WHERE ${fs} LIKE '%'||#{ss}||'%' 
		</select> -->
	<!-- 댓글 수 조회 -->
	<select id="n_ReplyCount" resultType="int" parameterType="int">
    	SELECT COUNT(*) FROM news_reply
    	WHERE bno=#{bno}
  	</select>
</mapper>









